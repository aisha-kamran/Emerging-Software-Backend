<!DOCTYPE html>
<html>
  <head>
    <title>Blogs & Admin API</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@3/swagger-ui.css">
    <style>
      html{
        box-sizing: border-box;
        overflow: -moz-scrollbars-vertical;
        overflow-y: scroll;
      }
      *,
      *:before,
      *:after{
        box-sizing: inherit;
      }
      body {
        margin:0;
        background: #fafafa;
      }
    </style>
  </head>
  <body>
    <div style="padding:8px;background:#fff;display:flex;gap:8px;align-items:center;">
      <label style="font-size:13px;color:#333;margin-right:6px;">Token:</label>
      <input id="token_display" placeholder="No token" style="flex:1;padding:6px;border:1px solid #ddd;border-radius:4px;" />
      <button id="copy_btn" style="padding:6px 10px;border-radius:4px;border:none;background:#1976d2;color:#fff;">Copy</button>
    </div>
    <div id="swagger-ui"></div>
    <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@3/swagger-ui-bundle.js" charset="UTF-8"></script>
    <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@3/swagger-ui-standalone-preset.js" charset="UTF-8"></script>
    <script>
      function setToken(token) {
        sessionStorage.setItem('access_token', token);
      }
      function getToken() {
        return sessionStorage.getItem('access_token');
      }

      let ui = null;

      window.onload = function() {
        ui = SwaggerUIBundle({
          url: '/openapi.json',
          dom_id: '#swagger-ui',
          deepLinking: true,
          presets: [SwaggerUIBundle.presets.apis, SwaggerUIStandalonePreset],
          plugins: [SwaggerUIBundle.plugins.DownloadUrl],
          layout: 'StandaloneLayout',
          // Capture responses from the UI's fetches
          responseInterceptor: function(response) {
            try {
              const url = response.url || '';
              if (url.includes('/admin/login') && response.status === 200) {
                // read token and authorize
                response.clone().json().then(function(data) {
                  if (data && data.access_token) {
                    setToken(data.access_token);
                    // programmatically authorize Swagger UI
                    try {
                      ui.authActions.authorize({
                        bearerAuth: {
                          name: 'bearerAuth',
                          schema: { type: 'http', scheme: 'bearer', bearerFormat: 'JWT' },
                          value: data.access_token
                        }
                      });
                    } catch (e) {
                      try { ui.preauthorizeApiKey('bearerAuth', data.access_token); } catch(e){}
                    }
                    const inp = document.getElementById('token_display');
                    if (inp) inp.value = data.access_token;
                    // small visual feedback
                    console.log('Auto-authorized with token');
                  }
                }).catch(()=>{});
              }
            } catch (e) { console.warn(e); }
            return response;
          },
          onComplete: function() {
            const token = getToken();
            if (token) {
              try {
                ui.authActions.authorize({ bearerAuth: { value: token } });
              } catch(e) {}
              const inp = document.getElementById('token_display'); if (inp) inp.value = token;
            }
          }
        });

        // Copy button
        const copyBtn = document.getElementById('copy_btn');
        copyBtn.addEventListener('click', function() {
          const inp = document.getElementById('token_display');
          if (!inp || !inp.value) return alert('No token to copy');
          navigator.clipboard.writeText(inp.value).then(function(){
            alert('Token copied to clipboard');
          }).catch(function(){
            alert('Could not copy token');
          });
        });
      };
    </script>
  </body>
</html>
